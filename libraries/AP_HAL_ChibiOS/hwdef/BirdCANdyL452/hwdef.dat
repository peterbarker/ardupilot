# hw definition file for processing by chibios_pins.py
# hardware repository: https://github.com/FlyfocusUAV/Bird-CANdy

# MCU class and specific type
# note: the device is STM32F412CE, not all F412 pins are available
MCU STM32L452 STM32L452xx

FLASH_RESERVE_START_KB 40
FLASH_SIZE_KB 512
STORAGE_FLASH_PAGE 18
define HAL_STORAGE_SIZE 800

# board ID for firmware load
APJ_BOARD_ID 1090

# setup build for a peripheral firmware
env AP_PERIPH 1

# ChibiOS system timer
STM32_ST_USE_TIMER 15
define CH_CFG_ST_RESOLUTION 16

# enable watchdog

# crystal frequency
OSCILLATOR_HZ 16000000

#define CH_CFG_ST_FREQUENCY 800000
#define HAL_USE_SERIAL FALSE

#STDOUT_SERIAL SD1
#STDOUT_BAUDRATE 57600

# order of UARTs
SERIAL_ORDER UART4 EMPTY EMPTY USART1

# ------ RCOUT pins ------

PA15 TIM2_CH1  TIM2 PWM(1) GPIO(51)
PB3  TIM2_CH2  TIM2 PWM(2) GPIO(52)
PB4  TIM3_CH1  TIM3 PWM(3) GPIO(53)

# ------ alternate functions for RCOUT pins ------

# USART1 for debug
PA9 USART1_TX USART1 NODMA
PA10 USART1_RX USART1 NODMA
define HAL_SERIAL0_BAUD_DEFAULT 115200

# ------ end RCOUT pins ------


# UART4 for GPS
PA0 UART4_TX UART4
PA1 UART4_RX UART4

# SWD debugging
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD



I2C_ORDER I2C1
PB7 I2C1_SDA I2C1
PB6 I2C1_SCL I2C1
define HAL_I2C_CLEAR_ON_TIMEOUT 0
define HAL_I2C_INTERNAL_MASK 0

#define HAL_USE_I2C TRUE
#define STM32_I2C_USE_I2C1 TRUE


define HAL_BARO_ALLOW_INIT_NO_BARO

define HAL_USE_ADC FALSE
define STM32_ADC_USE_ADC1 FALSE
define HAL_DISABLE_ADC_DRIVER TRUE

define HAL_NO_GPIO_IRQ

# avoid RCIN thread to save memory
define HAL_NO_RCIN_THREAD

define HAL_USE_RTC FALSE
define DISABLE_SERIAL_ESC_COMM TRUE

define DMA_RESERVE_SIZE 0


define HAL_DISABLE_LOOP_DELAY

# enable CAN support
CAN_ORDER 1
PB8 CAN1_RX CAN1
PB9 CAN1_TX CAN1
PB2 GPIO_CAN1_SILENT OUTPUT PUSHPULL SPEED_LOW LOW

define CAN_APP_NODE_NAME "LEFT WING EXP GPS"

define HAL_GCS_ENABLED 0
define HAL_NO_LOGGING
define HAL_NO_MONITOR_THREAD


define HAL_DEVICE_THREAD_STACK 768

define AP_PARAM_MAX_EMBEDDED_PARAM 512

# disable dual GPS and GPS blending to save flash space
define GPS_MAX_RECEIVERS 1
define GPS_MAX_INSTANCES 1

# RCOU+GPS+MAG+BARO+Buzzer+NeoPixels
#define HAL_PERIPH_ENABLE_RC_OUT
define AP_PERIPH_GPS_ENABLED 1
#define HAL_PERIPH_ENABLE_MAG
#define HAL_PERIPH_ENABLE_BARO
#define HAL_PERIPH_ENABLE_BUZZER
#define HAL_PERIPH_NEOPIXEL_COUNT 8
#define HAL_PERIPH_NEOPIXEL_CHAN 0
#define AP_PERIPH_LED_BRIGHT_DEFAULT 50

define HAL_PERIPH_ENABLE_RC_OUT

define AP_PERIPH_AIRSPEED_ENABLED 1
define HAL_AIRSPEED_BUS_DEFAULT 0
define HAL_AIRSPEED_TYPE_DEFAULT 6  
define AIRSPEED_MAX_SENSORS 1

#define HAL_GPS1_TYPE_DEFAULT 10
#define HAL_PERIPH_GPS_PORT_DEFAULT 0
#define GPS_SBF_STREAM_NUMBER 1
